%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%   DO NOT EDIT THIS FILE   %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{imsoptions}[2025/03/01 Nova IMS Template Options]

% Load packages
\RequirePackage{kvoptions}      % Modern key-value option handling
\RequirePackage{etoolbox}       % For boolean operations
\RequirePackage{xstring}        % For string operations
\RequirePackage{pgffor}         % For foreach loops
\RequirePackage{eso-pic,graphicx,xcolor}%

% Set up the key=value options
\SetupKeyvalOptions{
  family=imsoptions,
  prefix=paper@
}

% Define boolean options
\DeclareBoolOption[true]{draft} % Default is true (draft mode)

% Define string options with defaults
\DeclareStringOption[Author Name]{author}
\DeclareStringOption[Paper Title]{title}
\DeclareStringOption[]{subtitle}
\DeclareStringOption[Supervisor Name]{supervisor}
\DeclareStringOption[IMS]{programacronym}
\DeclareStringOption[Information Management School]{programfullname}
\DeclareStringOption[]{programspecialization}
\DeclareStringOption[]{sdgvalues}
\DeclareStringOption[]{keywords}
\DeclareStringOption[EN]{language}
\DeclareStringOption[pdflatex]{build}
\DeclareStringOption[\today]{date}
\DeclareStringOption[Thesis]{worktype}
\DeclareStringOption[_setup/_images/SDG_icons/]{sdgiconpath}
\DeclareStringOption[1.5cm]{sdgiconsize}

% Process the options
\ProcessKeyvalOptions*

% Additional boolean flags
\newif\ifpaper@hassubtitle
\ifdefempty{\paper@subtitle}{\paper@hassubtitlefalse}{\paper@hassubtitletrue}


% Getter commands 
\newcommand*{\paperauthor}{\paper@author}
\newcommand*{\papertitle}{\paper@title}
\newcommand*{\papersubtitle}{\paper@subtitle}
\newcommand*{\papersupervisor}{\paper@supervisor}
\newcommand*{\paperprogramacronym}{\paper@programacronym}
\newcommand*{\paperprogramfullname}{\paper@programfullname}
\newcommand*{\paperprogramspecialization}{\paper@programspecialization}
\newcommand*{\papersdgvalues}{\paper@sdgvalues}
\newcommand*{\paperkeywords}{\paper@keywords}
\newcommand*{\paperlanguage}{\paper@language}
\newcommand*{\paperbuild}{\paper@build}
\newcommand*{\paperdate}{\paper@date}
\newcommand*{\papersdgiconpath}{\paper@sdgiconpath}
\newcommand*{\papersdgiconsize}{\paper@sdgiconsize}
\newcommand*{\paperworktype}{\paper@worktype}


% Conditional commands
\newcommand*{\ifDraft}[2]{\ifpaper@draft #1\else #2\fi}
\newcommand*{\ifPrint}[2]{\ifpaper@draft #2\else #1\fi}
\newcommand*{\ifEnglish}[2]{\expandafter\ifstrequal\expandafter{\paper@language}{EN}{#1}{#2}}
\newcommand*{\ifPortuguese}[2]{\expandafter\ifstrequal\expandafter{\paper@language}{PT}{#1}{#2}}
\newcommand*{\ifHasSubtitle}[2]{\ifpaper@hassubtitle #1\else #2\fi}

\newcommand*{\ifLua}[2]{\expandafter\ifstrequal\expandafter{\paper@build}{lualatex}{#1}{#2}}


\ifPortuguese{
  \usepackage[portuguese]{babel}
}{
  \usepackage[english]{babel}
}

\usepackage{csquotes}

% SDG selection check
\newcommand*{\ifsdgselected}[3]{%
  \IfSubStr{,\paper@sdgvalues,}{,#1,}{#2}{#3}%
}

% Display SDG icons
\newcommand*{\displaysdgicons}{%
  \ifdefempty{\paper@sdgvalues}{}{%
    \ifEnglish{
      {\large\textbf{Sustainable Development Goals (SDG):}}%
    }{
      {\large\textbf{Objetivos do Desenvolvimento Sustent√°vel (ODS):}}%
    }
    
    \begin{figure}[h!]%
      \foreach \sdg in \paper@sdgvalues {%
        \ifnum\sdg<10 %
          \includegraphics[height=\paper@sdgiconsize]{\paper@sdgiconpath 0\sdg.png}\quad
        \else
          \includegraphics[height=\paper@sdgiconsize]{\paper@sdgiconpath \sdg.png}\quad
        \fi
      }%
    \end{figure}%
  }%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Setup Typography based on LaTeX engine %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifLua{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% pdfLaTeX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \RequirePackage[T1]{fontenc}
  \RequirePackage{fontspec}
  \newfontfamily{\arial}{Arial}  
  \newfontfamily{\calibri}{Calibri}[LetterSpace=-1.75, Kerning=On, Ligatures=NoCommon]
  \newfontfamily{\calibribold}{Calibri Bold}[
      Kerning=Off, 
      Ligatures=NoCommon]
  \setmainfont{Calibri}
  \setsansfont{Calibri}
  }{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% LuaLaTeX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  % Set up Arial separately for the \arial command
  \IfFileExists{uarial.sty}{
    \RequirePackage{uarial}
    \newcommand{\arial}{\fontfamily{ua1}\selectfont}
  }{
    \IfFileExists{arial.sty}{
      \RequirePackage{arial}
      \newcommand{\arial}{\fontfamily{arial}\selectfont}
    }{
      % If Arial is not available, define \arial to use Helvetica (similar to Arial)
      \newcommand{\arial}{\fontfamily{phv}\selectfont}
    }
  }
  % Try to use carlito with pdflatex if available
  \RequirePackage{carlito}
  \renewcommand{\familydefault}{\sfdefault}
}


\endinput